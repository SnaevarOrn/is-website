<!doctype html>
<html lang="is" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ís.is — Fréttir (v2)</title>

  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/favicon.png" sizes="32x32">
  <link rel="icon" href="/favicon.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <meta name="theme-color" content="#ffffff" id="metaThemeColor">

  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <link rel="stylesheet" href="/assets/css/pages/frettir.css">

  <script src="/assets/js/prefs.js"></script>
  <script>
    (function () {
      const t = (window.prefs && prefs.getTheme) ? prefs.getTheme() : (localStorage.getItem('theme') || 'dark');
      const theme = (t === 'dark') ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', theme);

      const meta = document.getElementById('metaThemeColor');
      if (meta) meta.setAttribute('content', theme === 'dark' ? '#0b0f14' : '#ffffff');
    })();
  </script>

  <!-- ✅ Frettir2: notum worker/D1 API -->
  <script>
    window.FRETTIR_API = "https://is-news-cron.rokogstormur.workers.dev/news";
  </script>
</head>

<body>
  <header class="page-header">
    <div class="ph-left">
      <button class="icon-btn" id="btnBack" aria-label="Til baka" title="Forsíða">←</button>

      <div class="ph-title">
        <nav class="ph-tabs" aria-label="Fréttasvæði">
          <a class="ph-tab" href="/frettir2/" data-tab="iceland">Íslands fréttir (v2)</a>
          <a class="ph-tab" href="/erlent/"  data-tab="world">Heimsfréttir</a>
        </nav>
      </div>
    </div>

    <div class="ph-right">
      <button class="icon-btn" id="btnMenu" aria-label="Valmynd" title="Valmynd">☰</button>
    </div>

    <div class="ph-meta" aria-live="polite">
      <span id="statusText" class="ph-status">Tilbúið.</span>

      <button id="btnLoadMore"
              class="nm-plus"
              type="button"
              hidden
              title="Sækja meira"
              aria-label="Sækja meira">+</button>

      <span id="statusSpinner" class="spinner sm" aria-hidden="true" hidden></span>
      <span id="loadProgressText" class="tiny muted ph-pct" hidden>0%</span>

      <span class="ph-dot">•</span>
      <span id="lastUpdated" class="ph-updated"></span>

      <div class="progress ph-progress" id="loadProgress" hidden aria-label="Hleðsla">
        <div class="progress-bar" id="loadProgressBar" style="width:0%"></div>
      </div>
    </div>

    <div class="menu-panel" id="menuPanel" aria-hidden="true">
      <div class="menu-card">
        <button class="menu-action" id="btnThemeToggle" type="button">
          <span class="ma-title">Þema</span>
          <span class="ma-sub">Light / Dark</span>
        </button>

        <button class="menu-action" id="btnOpenSettings" type="button">
          <span class="ma-title">Stillingar</span>
          <span class="ma-sub">Miðlar + síur</span>
        </button>

        <button class="menu-action" id="btnRefresh" type="button">
          <span class="ma-title">Endurhlaða</span>
          <span class="ma-sub">Sækja nýjustu</span>
        </button>

        <div class="menu-row-last">
          <a class="menu-link" href="/">Forsíða</a>
          <span class="menu-dot">•</span>
          <a class="menu-link" href="/spil/">Spil</a>
        </div>
      </div>
    </div>
  </header>

  <main class="page-main">
    <dialog class="settings" id="settingsDialog" aria-label="Stillingar">
      <form method="dialog" class="settings-card" id="settingsForm">
        <div class="settings-head">
          <div>
            <div class="settings-kicker">Fréttir</div>
            <h2>Stillingar</h2>
          </div>
          <button class="icon-btn" id="btnCloseSettings" type="button" aria-label="Loka" title="Loka">✕</button>
        </div>

        <div class="settings-grid">
          <section class="settings-section">
            <div class="sec-head">
              <h3>Fjölmiðlar</h3>
              <div class="sec-actions">
                <button type="button" class="seg-btn" id="btnSourcesAll">Allt</button>
                <button type="button" class="seg-btn" id="btnSourcesNone">Ekkert</button>
              </div>
            </div>
            <div class="checklist" id="sourcesList"></div>
          </section>

          <section class="settings-section">
            <div class="sec-head">
              <h3>Sía</h3>
              <div class="sec-actions">
                <button type="button" class="seg-btn" id="btnCatsAll">Allt</button>
                <button type="button" class="seg-btn" id="btnCatsNone">Ekkert</button>
              </div>
            </div>
            <div class="checklist" id="catsList"></div>
          </section>
        </div>

        <div class="settings-footer">
          <button type="button" class="pill-btn primary" id="btnSaveSettings">Vista</button>
          <button type="button" class="pill-btn" id="btnResetSettings">Endurstilla</button>
        </div>
      </form>
    </dialog>

    <section class="news-list" id="newsList" aria-label="Fréttalisti"></section>

    <section class="empty" id="emptyState" hidden>
      <h2>Ekkert fannst</h2>
      <p class="muted">Veldu fleiri miðla eða slakaðu á síum.</p>
      <button class="pill-btn primary" id="btnEmptyOpenSettings" type="button">Stillingar</button>
    </section>

    <section class="error" id="errorState" hidden>
      <h2>Villa</h2>
      <p class="muted" id="errorMsg">Gat ekki sótt fréttir.</p>
      <button class="pill-btn primary" id="btnRetry" type="button">Reyna aftur</button>
    </section>

    <dialog class="reading" id="readingDialog" aria-label="Leshamur">
      <div class="reading-card" role="document">
        <div class="reading-head">
          <div class="reading-kicker" id="readingSite">Frétt</div>
          <button class="icon-btn" id="btnCloseReading" type="button" aria-label="Loka" title="Loka">✕</button>
        </div>

        <h2 class="reading-title" id="readingTitle">Hleð…</h2>

        <div class="reading-actions">
          <a class="pill-btn" id="readingOpenOriginal" href="#" target="_blank" rel="noopener noreferrer" referrerpolicy="no-referrer">
            Opna upprunalega
          </a>
          <button class="pill-btn primary" id="readingMarkRead" type="button">
            Merkja lesið
          </button>
        </div>

        <div class="reading-body" id="readingBody">
          <p class="muted">Sæki texta…</p>
        </div>

        <div class="reading-foot tiny muted" id="readingMeta"></div>
      </div>
    </dialog>
  </main>

  <script src="/assets/js/utils.js"></script>
  <script src="/assets/js/theme.js"></script>
  <script>window.FRETTIR_API="https://is-news-cron.rokogstormur.workers.dev/news";</script>
  <script src="/assets/js/pages/frettir2.js" defer></script>
</body>
</html>
