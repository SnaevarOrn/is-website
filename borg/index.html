<!doctype html>
<html lang="is">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B√¶ir ‚Äî √≠s.is</title>
  <style>
    :root{
      --bg:#07090f;
      --text:#e9eefc;
      --muted:#9aa6c3;
      --line:rgba(255,255,255,.10);
      --accent:#7dd3fc;
      --good:#86efac;
      --bad:#fca5a5;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --pin:#fb7185; /* rau√∞ur pin */
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 50% -10%, rgba(125,211,252,.15), transparent 55%),
                  radial-gradient(900px 600px at 20% 20%, rgba(167,139,250,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    /* Header (eins og √≠ j√∂klaleik) */
    .shell{ width:min(1100px, 100%); display:grid; gap:10px; }
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.18);
      box-shadow: var(--shadow);
    }
    .header a{
      color: var(--text);
      text-decoration:none;
      font-weight:800;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      padding:8px 10px;
      border-radius:12px;
    }
    .header a:hover{ background: rgba(255,255,255,.06); }
    .brand{
      color: var(--muted);
      font-weight:800;
      letter-spacing:.2px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .top{
      padding:12px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:10px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.10);
    }
    @media (max-width: 900px){
      .top{ grid-template-columns: 1fr; }
    }

    .prompt{
      padding:12px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      min-height:74px;
    }
    .label{
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    .city{
      font-size:22px;
      font-weight:900;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .prompt .right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      flex:0 0 auto;
      min-width: 170px;
    }
    .chip{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.15);
    }
    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:900;
      transition: transform .05s ease, background .15s ease;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.06); }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; }
    .danger{
      border-color: rgba(252,165,165,.35);
      background: rgba(252,165,165,.08);
    }
    .primary{
      border-color: rgba(125,211,252,.35);
      background: rgba(125,211,252,.10);
    }
    .small{
      padding:8px 10px;
      font-size:13px;
      border-radius:10px;
      font-weight:900;
    }

    .info{
      padding:12px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(0,0,0,.16);
      display:grid;
      gap:10px;
    }
    .infoTop{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mini{
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background: rgba(0,0,0,.12);
    }
    .mini .k{ font-size:12px; color:var(--muted); }
    .mini .v{ font-size:18px; font-weight:900; margin-top:2px; }

    .toast{
      padding:12px;
      border:1px solid var(--line);
      border-radius:12px;
      background: rgba(0,0,0,.18);
      min-height: 54px;
    }
    .toast .t{ font-size:12px; color:var(--muted); }
    .toast .m{ margin-top:6px; font-size:14px; line-height:1.35; }

    .good{ color: var(--good); font-weight:900; }
    .bad{ color: var(--bad); font-weight:900; }

    /* Map */
    .mapWrap{
      position:relative;
      height: min(74vh, 720px);
      min-height: 420px;
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      overflow:hidden;
    }
    .mapViewport{
      position:absolute;
      inset:0;
      cursor: grab;
      touch-action: none;
      background: rgba(0,0,0,.10);
    }
    .mapViewport:active{ cursor: grabbing; }

    .mapLayer{
      position:absolute;
      left:0; top:0;
      transform-origin: 0 0;
      will-change: transform;
    }
    .mapImg{
      display:block;
      user-drag:none;
      -webkit-user-drag:none;
      user-select:none;
      pointer-events:none;
      max-width:none;
    }

    /* Markers */
    .marker{
      position:absolute;
      width:16px; height:16px;
      border-radius:50%;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255,255,255,.9);
      box-shadow: 0 10px 22px rgba(0,0,0,.45);
      pointer-events:none;
    }
    .marker.pin{
      width:18px; height:18px;
      background: var(--pin);
      border-color: rgba(255,255,255,.95);
      display:none;
    }
    .marker.truth{ background: rgba(134,239,172,.95); display:none; }

    /* ‚ÄúB√∫bblur‚Äù sem liggja eftir */
    .dot{
      position:absolute;
      width:10px; height:10px;
      border-radius:50%;
      transform: translate(-50%,-50%);
      border:1px solid rgba(255,255,255,.35);
      background: rgba(125,211,252,.45);
      box-shadow: 0 6px 14px rgba(0,0,0,.35);
      pointer-events:none;
    }

    .line{
      position:absolute;
      height:2px;
      background: rgba(255,255,255,.75);
      transform-origin: 0 50%;
      display:none;
      pointer-events:none;
      box-shadow: 0 8px 18px rgba(0,0,0,.35);
    }

    .overlay{
      position:absolute;
      right:12px;
      top:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      z-index: 5;
    }
    .overlay .row{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }

    /* Confirm bubble (√≠ viewport, ekki inni √≠ layer) */
    .confirm{
      position:absolute;
      z-index: 6;
      display:none;
      transform: translate(10px, -50%);
      pointer-events:auto;
    }
    .confirm button{
      padding:9px 11px;
      border-radius:12px;
      font-size:13px;
      font-weight:900;
      border-color: rgba(251,113,133,.45);
      background: rgba(251,113,133,.12);
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <!-- laga√∞u href ef fors√≠√∞a er annars sta√∞ar -->
      <a href="/">‚Üê Til baka</a>
      <div class="brand">√≠s.is ‚Äî pr√≥t√≥t√Ωpa</div>
    </div>

    <div class="card">
      <div class="top">
        <div class="prompt">
          <div class="left">
            <div class="label">Tappa√∞u til a√∞ setja pin, drag til a√∞ f√¶ra kort</div>
            <div class="city" id="cityName">‚Äî</div>
          </div>
          <div class="right">
            <div class="chip" id="roundChip">Umfer√∞ 1/5</div>
            <div class="btnRow">
              <button class="danger" id="restartBtn">Byrja aftur</button>
            </div>
          </div>
        </div>

        <div class="info">
          <div class="infoTop">
            <div class="mini">
              <div class="k">Stig (samtals)</div>
              <div class="v" id="totalScore">0</div>
            </div>
            <div class="mini">
              <div class="k">S√≠√∞asta</div>
              <div class="v" id="lastScore">‚Äî</div>
            </div>
          </div>

          <div class="toast" id="toast">
            <div class="t">Ni√∞ursta√∞a</div>
            <div class="m" id="toastMsg">Tappa√∞u √° korti√∞ til a√∞ setja pin.</div>
          </div>
        </div>
      </div>

      <div class="mapWrap">
        <div class="overlay">
          <div class="row">
            <button class="small" id="zoomIn">+</button>
            <button class="small" id="zoomOut">‚àí</button>
            <button class="small" id="fitBtn">Mi√∞ja</button>
          </div>
        </div>

        <div class="confirm" id="confirmBubble">
          <button class="primary" id="confirmBtn">Sta√∞festa</button>
        </div>

        <div class="mapViewport" id="viewport" aria-label="Kort">
          <div class="mapLayer" id="layer">
            <img id="mapImg" class="mapImg" alt="Kort af √çslandi" />
            <div class="marker pin" id="pinMarker"></div>
            <div class="marker truth" id="truthMarker"></div>
            <div class="line" id="line"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const MAP_SRC = "./assets/iceland_map.png";

  // N√Ωju b√¶irnir: √°giskunar-hnit (stilltu ef √æarf)
  const CITIES = [
    { name: "Reykjav√≠k",   x: 0.28, y: 0.70 },
    { name: "√çsafj√∂r√∞ur",  x: 0.20, y: 0.33 },
    { name: "Akureyri",    x: 0.52, y: 0.34 },
    { name: "Egilssta√∞ir", x: 0.78, y: 0.48 },
    { name: "H√∂fn √≠ Hornafir√∞i", x: 0.73, y: 0.80 },

    { name: "Sau√∞√°rkr√≥kur", x: 0.48, y: 0.30 },
    { name: "Fl√∫√∞ir",       x: 0.33, y: 0.77 },
    { name: "Stykkish√≥lmur",x: 0.29, y: 0.56 },
    { name: "Gr√≠msey",      x: 0.54, y: 0.15 },
    { name: "K√≥pasker",     x: 0.66, y: 0.28 },
  ];

  const MAX_DIST_PX = 380;

  let idx = 0;
  let total = 0;
  let last = null;
  let locked = false; // √æegar stig eru reiknu√∞/√≠ ‚Äútransition‚Äù (vi√∞ notum √æa√∞ l√©tt)

  // pending (√≥sta√∞festur) pin
  let pendingN = null;

  // pan/zoom
  let scale = 1;
  let tx = 0, ty = 0;

  // pointer tracking (drag + pinch)
  const pointers = new Map();
  let pinch = null;
  let drag = { active:false, moved:false, startX:0, startY:0, startTx:0, startTy:0, startT:0 };

  const mapImg = document.getElementById("mapImg");
  const viewport = document.getElementById("viewport");
  const layer = document.getElementById("layer");

  const cityName = document.getElementById("cityName");
  const roundChip = document.getElementById("roundChip");
  const totalScore = document.getElementById("totalScore");
  const lastScore = document.getElementById("lastScore");
  const toastMsg = document.getElementById("toastMsg");

  const pinMarker = document.getElementById("pinMarker");
  const truthMarker = document.getElementById("truthMarker");
  const lineEl = document.getElementById("line");

  const restartBtn = document.getElementById("restartBtn");
  const zoomIn = document.getElementById("zoomIn");
  const zoomOut = document.getElementById("zoomOut");
  const fitBtn = document.getElementById("fitBtn");

  const confirmBubble = document.getElementById("confirmBubble");
  const confirmBtn = document.getElementById("confirmBtn");

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }
  function imageSize(){ return { w: mapImg.naturalWidth || 1, h: mapImg.naturalHeight || 1 }; }

  function clampTransform(){
    const rect = viewport.getBoundingClientRect();
    const vw = rect.width, vh = rect.height;
    const s = imageSize();
    const iw = s.w * scale;
    const ih = s.h * scale;

    if (iw <= vw) tx = (vw - iw) / 2;
    else tx = clamp(tx, vw - iw, 0);

    if (ih <= vh) ty = (vh - ih) / 2;
    else ty = clamp(ty, vh - ih, 0);
  }

  function applyTransform(){
    clampTransform();
    layer.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
    // ef vi√∞ erum me√∞ pending pin: f√¶ra confirm bubble r√©tt
    if (pendingN) positionConfirmBubble(pendingN);
  }

  function pxFromNormalized(p){
    const s = imageSize();
    return { x: p.x * s.w, y: p.y * s.h };
  }

  function normalizedFromClient(clientX, clientY){
    const rect = viewport.getBoundingClientRect();
    const vx = clientX - rect.left;
    const vy = clientY - rect.top;

    const lx = (vx - tx) / scale;
    const ly = (vy - ty) / scale;

    const s = imageSize();
    return { x: lx / s.w, y: ly / s.h };
  }

  function viewportXYFromNormalized(n){
    // hvar punktur er √≠ viewport px (nota√∞ fyrir confirm bubble)
    const px = pxFromNormalized(n);
    return { vx: px.x * scale + tx, vy: px.y * scale + ty };
  }

  function scoreFromDistance(distPx){
    const t = 1 - clamp(distPx / MAX_DIST_PX, 0, 1);
    return Math.round(Math.pow(t, 1.6) * 100);
  }

  function showPendingPin(n){
    pendingN = n;

    const p = pxFromNormalized(n);
    pinMarker.style.left = p.x + "px";
    pinMarker.style.top  = p.y + "px";
    pinMarker.style.display = "block";

    // fela truth/line √æar til sta√∞fest
    truthMarker.style.display = "none";
    lineEl.style.display = "none";

    toastMsg.textContent = "Sta√∞setning valin ‚Äî √Ωttu √° Sta√∞festa (e√∞a tappa√∞u aftur til a√∞ f√¶ra).";

    positionConfirmBubble(n);
    confirmBubble.style.display = "block";
  }

  function positionConfirmBubble(n){
    const rect = viewport.getBoundingClientRect();
    const { vx, vy } = viewportXYFromNormalized(n);

    // sta√∞setja √≠ mapWrap coordinate space (relative)
    // confirmBubble er inni √≠ mapWrap og position:absolute; √æannig vi√∞ notum vx/vy (sem eru relative to viewport)
    // viewport byrjar efst vinstra √≠ mapWrap, svo √æetta er beint noth√¶ft.
    const x = clamp(vx, 12, rect.width - 12);
    const y = clamp(vy, 12, rect.height - 12);

    confirmBubble.style.left = x + "px";
    confirmBubble.style.top  = y + "px";
  }

  function leaveDot(n){
    const p = pxFromNormalized(n);
    const dot = document.createElement("div");
    dot.className = "dot";
    dot.style.left = p.x + "px";
    dot.style.top  = p.y + "px";
    layer.appendChild(dot);
  }

  function setMarkersAndLine(guessPx, truthPx){
    truthMarker.style.left = truthPx.x + "px";
    truthMarker.style.top  = truthPx.y + "px";
    truthMarker.style.display = "block";

    const dx = truthPx.x - guessPx.x;
    const dy = truthPx.y - guessPx.y;
    const len = Math.hypot(dx, dy);
    const ang = Math.atan2(dy, dx) * 180 / Math.PI;

    lineEl.style.left = guessPx.x + "px";
    lineEl.style.top = guessPx.y + "px";
    lineEl.style.width = len + "px";
    lineEl.style.transform = `rotate(${ang}deg)`;
    lineEl.style.display = "block";
  }

  function clearPending(){
    pendingN = null;
    pinMarker.style.display = "none";
    confirmBubble.style.display = "none";
  }

  function setRound(){
    const c = CITIES[idx];
    cityName.textContent = c.name;
    roundChip.textContent = `Umfer√∞ ${idx+1}/${CITIES.length}`;
    clearPending();
    truthMarker.style.display = "none";
    lineEl.style.display = "none";
    toastMsg.textContent = "Tappa√∞u √° korti√∞ til a√∞ setja pin.";
    lastScore.textContent = last === null ? "‚Äî" : String(last);
  }

  function fit(){
    const s = imageSize();
    const rect = viewport.getBoundingClientRect();
    const vw = rect.width, vh = rect.height;

    const fitScale = Math.min(vw / s.w, vh / s.h);
    scale = clamp(fitScale, 0.6, 6);

    tx = (vw - s.w * scale) / 2;
    ty = (vh - s.h * scale) / 2;
    applyTransform();
  }

  function zoomAt(factor, clientX, clientY){
    const rect = viewport.getBoundingClientRect();
    const vx = clientX - rect.left;
    const vy = clientY - rect.top;

    const newScale = clamp(scale * factor, 0.6, 6);

    const lx = (vx - tx) / scale;
    const ly = (vy - ty) / scale;

    tx = vx - lx * newScale;
    ty = vy - ly * newScale;
    scale = newScale;

    applyTransform();
  }

  function zoomAtViewportPoint(newScale, vx, vy){
    newScale = clamp(newScale, 0.6, 6);

    const lx = (vx - tx) / scale;
    const ly = (vy - ty) / scale;

    tx = vx - lx * newScale;
    ty = vy - ly * newScale;
    scale = newScale;

    applyTransform();
  }

  function confirmGuess(){
    if (!pendingN || locked) return;
    locked = true;

    const c = CITIES[idx];
    const truthN = { x: c.x, y: c.y };

    const guessPx = pxFromNormalized(pendingN);
    const truthPx = pxFromNormalized(truthN);

    const distPx = Math.hypot(guessPx.x - truthPx.x, guessPx.y - truthPx.y);
    const pts = scoreFromDistance(distPx);

    last = pts;
    total += pts;

    totalScore.textContent = String(total);
    lastScore.textContent = String(last);

    // ‚Äúb√∫bblan‚Äù situr eftir √° giskinu
    leaveDot(pendingN);

    // s√Ωna line+truth
    setMarkersAndLine(guessPx, truthPx);

    const vibe = pts >= 70 ? "N√°l√¶gt!" : (pts >= 35 ? "Ekki sl√¶mt." : "√ûetta var‚Ä¶ dj√∂rf n√°lgun üòÑ");
    toastMsg.innerHTML = `<span class="${pts>=70?'good':(pts>=35?'':'bad')}">${pts} stig</span> ‚Äî fjarl√¶g√∞ ~ ${Math.round(distPx)} px. ${vibe}`;

    // hreinsa pending UI (pin + sta√∞festa)
    clearPending();

    // hoppa sj√°lfkrafa √≠ n√¶sta (me√∞ √∂rlitlum ‚Äúp√°sa‚Äù svo ni√∞ursta√∞an sj√°ist)
    setTimeout(() => {
      idx++;
      if (idx >= CITIES.length){
        const avg = Math.round(total / CITIES.length);
        cityName.textContent = "‚Äî";
        roundChip.textContent = `Loki√∞ (${CITIES.length}/${CITIES.length})`;
        toastMsg.innerHTML = `<span class="good">Leik loki√∞!</span> Samtals: <b>${total}</b> stig (me√∞altal ${avg}).`;
        locked = false;
        return;
      }
      setRound();
      locked = false;
    }, 650);
  }

  // ===== Pointer: pan + pinch + tap-to-place (NO drag-to-guess) =====
  viewport.addEventListener("pointerdown", (e) => {
    viewport.setPointerCapture(e.pointerId);
    pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

    // byrja ‚Äúdrag‚Äù (pan) state fyrir 1 fingur
    if (pointers.size === 1){
      drag = {
        active:true,
        moved:false,
        startX:e.clientX,
        startY:e.clientY,
        startTx:tx,
        startTy:ty,
        startT: performance.now()
      };
    }

    // pinch init
    if (pointers.size === 2){
      const pts = Array.from(pointers.values());
      const dx = pts[1].x - pts[0].x;
      const dy = pts[1].y - pts[0].y;
      const dist = Math.hypot(dx, dy) || 1;

      const rect = viewport.getBoundingClientRect();
      const midClientX = (pts[0].x + pts[1].x) / 2;
      const midClientY = (pts[0].y + pts[1].y) / 2;
      pinch = {
        startDist: dist,
        startScale: scale,
        midVx: midClientX - rect.left,
        midVy: midClientY - rect.top
      };
    }
  });

  viewport.addEventListener("pointermove", (e) => {
    if (!pointers.has(e.pointerId)) return;
    pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

    // pinch zoom
    if (pointers.size === 2 && pinch){
      const pts = Array.from(pointers.values());
      const dx = pts[1].x - pts[0].x;
      const dy = pts[1].y - pts[0].y;
      const dist = Math.hypot(dx, dy) || 1;

      const ratio = dist / pinch.startDist;
      zoomAtViewportPoint(pinch.startScale * ratio, pinch.midVx, pinch.midVy);
      return;
    }

    // one-finger pan
    if (pointers.size === 1 && drag.active){
      const dx = e.clientX - drag.startX;
      const dy = e.clientY - drag.startY;

      // mark moved if beyond threshold
      if (!drag.moved && Math.hypot(dx, dy) > 8) drag.moved = true;

      tx = drag.startTx + dx;
      ty = drag.startTy + dy;
      applyTransform();
    }
  });

  viewport.addEventListener("pointerup", (e) => {
    if (!pointers.has(e.pointerId)) return;
    const start = pointers.get(e.pointerId);
    pointers.delete(e.pointerId);

    if (pointers.size < 2) pinch = null;

    // tap-to-place only if it was a *quick* tap and not a pan
    if (drag.active){
      const dt = performance.now() - drag.startT;
      const movedDist = Math.hypot(e.clientX - drag.startX, e.clientY - drag.startY);
      const isTap = !drag.moved && movedDist < 8 && dt < 260;

      drag.active = false;

      if (!locked && isTap){
        const n = normalizedFromClient(e.clientX, e.clientY);
        if (n.x >= 0 && n.x <= 1 && n.y >= 0 && n.y <= 1){
          showPendingPin(n);
        } else {
          toastMsg.textContent = "Tappa√∞u innan myndarinnar.";
        }
      }
    }
  });

  viewport.addEventListener("pointercancel", (e) => {
    pointers.delete(e.pointerId);
    drag.active = false;
    if (pointers.size < 2) pinch = null;
  });

  // wheel zoom
  viewport.addEventListener("wheel", (e) => {
    e.preventDefault();
    const factor = e.deltaY < 0 ? 1.12 : 0.89;
    zoomAt(factor, e.clientX, e.clientY);
  }, { passive:false });

  zoomIn.addEventListener("click", () => {
    const r = viewport.getBoundingClientRect();
    zoomAt(1.18, r.left + r.width/2, r.top + r.height/2);
  });
  zoomOut.addEventListener("click", () => {
    const r = viewport.getBoundingClientRect();
    zoomAt(0.85, r.left + r.width/2, r.top + r.height/2);
  });
  fitBtn.addEventListener("click", fit);

  confirmBtn.addEventListener("click", confirmGuess);

  // ‚ÄúEnter‚Äù til a√∞ sta√∞festa (nice √° desktop)
  window.addEventListener("keydown", (e) => {
    if (e.key === "Enter") confirmGuess();
  });

  restartBtn.addEventListener("click", () => {
    idx = 0; total = 0; last = null; locked = false;
    totalScore.textContent = "0";
    lastScore.textContent = "‚Äî";
    toastMsg.textContent = "Tappa√∞u √° korti√∞ til a√∞ setja pin.";
    // hreinsa dots (saga)
    layer.querySelectorAll(".dot").forEach(el => el.remove());
    setRound();
    fit();
  });

  window.addEventListener("resize", () => applyTransform());

  // init
  mapImg.src = MAP_SRC;
  mapImg.addEventListener("load", () => {
    const s = imageSize();
    layer.style.width = s.w + "px";
    layer.style.height = s.h + "px";
    fit();
    setRound();
  });
  mapImg.addEventListener("error", () => {
    toastMsg.innerHTML = `<span class="bad">Finn ekki kortmynd:</span> <code>${MAP_SRC}</code>`;
  });
})();
</script>
</body>
</html>