<!DOCTYPE html>
<html lang="is" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ã­s.is</title>

  <!-- Favicons -->
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/favicon.png" sizes="32x32">
  <link rel="icon" href="/favicon.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <meta name="theme-color" content="#f5f6f8" id="metaThemeColor">

  <!-- Shared CSS -->
  <link rel="stylesheet" href="/assets/css/base.css">

  <!-- prefs.js must load BEFORE we call prefs.* (avoid flash) -->
  <script src="/assets/js/prefs.js"></script>
  <script>
    prefs.applyThemeFromStorage();
  </script>

  <!-- Shared UI wiring (menu, overlays, ESC, click-outside, logo) -->
  <script defer src="/assets/js/site.js"></script>
</head>

<body>
  <header>
    <div class="hdr">
      <button class="brand-left" id="logoBtn" aria-label="Heim">
        <img id="logoImg" src="/favicon.svg" alt="Ã­s.is"
             onerror="this.onerror=null; this.src='/favicon.png';">
      </button>

      <div class="brand-title">Ã­s.is</div>

      <div class="menu-wrap">
        <!-- LANGUAGE TOGGLE -->
        <button class="icon-btn lang-btn" id="langBtn" aria-label="TungumÃ¡l">
          <span class="lang-flag" id="langFlag">ğŸ‡®ğŸ‡¸</span>
          <span class="lang-pill" id="langPill">IS</span>
        </button>

        <!-- BURGER -->
        <button class="icon-btn" id="menuBtn" aria-label="Valmynd">
          <div class="burger" aria-hidden="true">
            <span></span><span></span><span></span>
          </div>
        </button>

        <div class="menu-pop" id="menuPop" role="menu" aria-hidden="true">
          <button class="menu-item" id="menuSettings" role="menuitem">
            <span data-i18n="menu.settings">Stillingar</span><span class="hint">âš™ï¸</span>
          </button>
          <button class="menu-item" id="menuAbout" role="menuitem">
            <span data-i18n="menu.about">Um vefinn</span><span class="hint">â„¹ï¸</span>
          </button>
          <button class="menu-item" id="menuContact" role="menuitem">
            <span data-i18n="menu.contact">Hafa samband</span><span class="hint">âœ‰ï¸</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="card">
        <div class="section-title" data-i18n="iceland.title">Ãsland</div>
        <div class="btns">
          <button class="btn" onclick="location.href='/spil/'" data-i18n="btn.glaciers">JÃ¶klar ğŸ§Š</button>
          <button class="btn" onclick="location.href='/borg/'" data-i18n="btn.towns">BÃ¦ir ğŸ˜ï¸</button>
        </div>
      </div>

      <div class="card">
        <div class="section-title" data-i18n="tools.title">VerkfÃ¦ri</div>
        <div class="btns">
          <button class="btn" onclick="location.href='/dagatal/'" data-i18n="btn.calendar">Dagatal ğŸ—“ï¸</button>
          <button class="btn" onclick="location.href='/klukka/'" data-i18n="btn.clock">Klukka ğŸ•’</button>
          <button class="btn" onclick="location.href='/slemb/'" data-i18n="btn.random">SlembiÃºrtak ğŸ²</button>
          <button class="btn" onclick="location.href='/WOD/'" data-i18n="btn.timer">TÃ­matalning â±ï¸</button>
          <button class="btn" onclick="location.href='/frettir/'" data-i18n="btn.news">FrÃ©ttir ğŸ“°</button>
        </div>
      </div>
    </div>
  </main>

  <div class="banner">
    <div class="pill" data-i18n="footer.pill">Vefur stofnaÃ°ur 2025. Engar vafrakÃ¶kur â€“ bara Ã­s.</div>
  </div>

  <!-- CONTACT MODAL -->
  <div class="overlay" id="contactOverlay" role="dialog" aria-modal="true" aria-labelledby="contactTitle">
    <div class="modal">
      <div class="modal-h">
        <b id="contactTitle" data-i18n="contact.title">Hafa samband</b>
        <button class="close" id="contactClose" aria-label="Loka">âœ•</button>
      </div>

      <form id="contactForm" autocomplete="on">
        <div class="row">
          <div>
            <label for="name" data-i18n="contact.nameLabel">Nafn</label>
            <input id="name" name="name" required placeholder="Nafn" data-i18n-placeholder="contact.namePh" />
          </div>
          <div>
            <label for="email" data-i18n="contact.emailLabel">TÃ¶lvupÃ³stur</label>
            <input id="email" name="email" type="email" required placeholder="nafn@dÃ¦mi.is" data-i18n-placeholder="contact.emailPh" />
          </div>
        </div>

        <div>
          <label for="message" data-i18n="contact.msgLabel">Erindi</label>
          <textarea id="message" name="message" required placeholder="SkrifaÃ°u erindiÃ° hÃ©r..." data-i18n-placeholder="contact.msgPh"></textarea>
        </div>

        <button class="send" type="submit" data-i18n="contact.send">Senda</button>
        <div class="status" id="status"></div>
      </form>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="overlay" id="settingsOverlay" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal">
      <div class="modal-h">
        <b id="settingsTitle" data-i18n="settings.title">Stillingar</b>
        <button class="close" id="settingsClose" aria-label="Loka">âœ•</button>
      </div>

      <div class="settings-body">
        <div class="toggle-row">
          <div>
            <b data-i18n="settings.themeTitle">Ãema</b><br/>
            <span data-i18n="settings.themeHint">Light / Dark</span>
          </div>
          <label class="switch">
            <span style="opacity:.8">ğŸŒ™</span>
            <input type="checkbox" id="themeToggle">
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- ABOUT MODAL -->
  <div class="overlay" id="aboutOverlay" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
    <div class="modal">
      <div class="modal-h">
        <b id="aboutTitle" data-i18n="about.title">Um vefinn</b>
        <button class="close" id="aboutClose" aria-label="Loka">âœ•</button>
      </div>

      <div class="settings-body">
        <div class="toggle-row about-block" style="display:block">
          <b>Ã­s.is</b><br/>
          <span data-i18n="about.p1">Vefur stofnaÃ°ur 2025 og er sjÃ¡lfstÃ¦tt verkefni unniÃ° af einstaklingi, Ã¡n auglÃ½singa, rekstrarfÃ©laga eÃ°a gagnasÃ¶fnunar.</span>
          <span data-i18n="about.p2">MarkmiÃ° vefsins er aÃ° miÃ°la Ã¾ekkingu um Ãsland Ã¡ einfaldan, gagnvirkan og aÃ°gengilegan hÃ¡tt â€“ Ã­ Ã¾Ã¡gu almennings.</span>
          <span data-i18n="about.p3">Vefurinn er opinn og Ã³keypis.</span>
          <span data-i18n="about.p4">Ãeir sem vilja geta stutt viÃ° Ã¡framhaldandi Ã¾rÃ³un meÃ° frjÃ¡lsu framlagi eÃ°a endurgjÃ¶f. SlÃ­kur stuÃ°ningur nÃ½tist beint Ã­ uppbyggingu og viÃ°hald.</span>
          <span data-i18n="about.p5">Engar auglÃ½singar. Engar vafrakÃ¶kur. Bara Ãsland.</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- i18n ----------
    const I18N = {
      is: {
        "menu.settings": "Stillingar",
        "menu.about": "Um vefinn",
        "menu.contact": "Hafa samband",

        "iceland.title": "Ãsland",
        "btn.glaciers": "JÃ¶klar ğŸ§Š",
        "btn.towns": "BÃ¦ir ğŸ˜ï¸",
        "btn.random": "SlembiÃºrtak ğŸ²",

        "tools.title": "VerkfÃ¦ri",
        "btn.calendar": "Dagatal ğŸ—“ï¸",
        "btn.clock": "Klukka ğŸ•’",
        "btn.timer": "TÃ­matalning â±ï¸",
        "btn.news": "FrÃ©ttir ğŸ“°",

        "footer.pill": "Vefur stofnaÃ°ur 2025. Engar vafrakÃ¶kur â€“ bara Ã­s.",

        "contact.title": "Hafa samband",
        "contact.nameLabel": "Nafn",
        "contact.emailLabel": "TÃ¶lvupÃ³stur",
        "contact.msgLabel": "Erindi",
        "contact.send": "Senda",
        "contact.namePh": "Nafn",
        "contact.emailPh": "nafn@dÃ¦mi.is",
        "contact.msgPh": "SkrifaÃ°u erindiÃ° hÃ©r...",

        "settings.title": "Stillingar",
        "settings.themeTitle": "Ãema",
        "settings.themeHint": "Light / Dark",

        "about.title": "Um vefinn",
        "about.p1": "Vefur stofnaÃ°ur 2025 og er sjÃ¡lfstÃ¦tt verkefni unniÃ° af einstaklingi, Ã¡n auglÃ½singa, rekstrarfÃ©laga eÃ°a gagnasÃ¶fnunar.",
        "about.p2": "MarkmiÃ° vefsins er aÃ° miÃ°la Ã¾ekkingu um Ãsland Ã¡ einfaldan, gagnvirkan og aÃ°gengilegan hÃ¡tt â€“ Ã­ Ã¾Ã¡gu almennings.",
        "about.p3": "Vefurinn er opinn og Ã³keypis.",
        "about.p4": "Ãeir sem vilja geta stutt viÃ° Ã¡framhaldandi Ã¾rÃ³un meÃ° frjÃ¡lsu framlagi eÃ°a endurgjÃ¶f. SlÃ­kur stuÃ°ningur nÃ½tist beint Ã­ uppbyggingu og viÃ°hald.",
        "about.p5": "Engar auglÃ½singar. Engar vafrakÃ¶kur. Bara Ãsland."
      },
      en: {
        "menu.settings": "Settings",
        "menu.about": "About",
        "menu.contact": "Contact",

        "iceland.title": "Iceland",
        "btn.glaciers": "Glaciers ğŸ§Š",
        "btn.towns": "Towns ğŸ˜ï¸",
        "btn.random": "Random pick ğŸ²",

        "tools.title": "Tools",
        "btn.calendar": "Calendar ğŸ—“ï¸",
        "btn.clock": "Clock ğŸ•’",
        "btn.timer": "Timer â±ï¸",
        "btn.news": "News ğŸ“°",

        "footer.pill": "Site created 2025. No cookies â€” just ice.",

        "contact.title": "Contact",
        "contact.nameLabel": "Name",
        "contact.emailLabel": "Email",
        "contact.msgLabel": "Message",
        "contact.send": "Send",
        "contact.namePh": "Name",
        "contact.emailPh": "name@example.com",
        "contact.msgPh": "Write your message here...",

        "settings.title": "Settings",
        "settings.themeTitle": "Theme",
        "settings.themeHint": "Light / Dark",

        "about.title": "About",
        "about.p1": "Created in 2025 as an independent, personal project â€” with no ads, no companies behind it, and no tracking.",
        "about.p2": "The goal is to share knowledge about Iceland in a simple, interactive, and accessible way â€” for the public.",
        "about.p3": "Free and open to use.",
        "about.p4": "If you want to support further development, feedback or a voluntary contribution helps keep the site improving.",
        "about.p5": "No ads. No cookies. Just Iceland."
      }
    };

    function applyLangToUI(){
      prefs.applyLang(I18N);

      const L = prefs.get('lang', 'is') === 'en' ? 'en' : 'is';
      const flag = document.getElementById('langFlag');
      const pill = document.getElementById('langPill');
      if(flag && pill){
        if (L === 'is'){ flag.textContent = 'ğŸ‡®ğŸ‡¸'; pill.textContent = 'IS'; }
        else { flag.textContent = 'ğŸ‡¬ğŸ‡§'; pill.textContent = 'EN'; }
      }
    }

    // init language
    if (!prefs.get('lang', null)) prefs.setLang('is');
    applyLangToUI();

    // toggle language
    document.getElementById('langBtn').addEventListener('click', (e) => {
      e.preventDefault(); e.stopPropagation();
      prefs.toggleLang();
      applyLangToUI();
    });

    // ---------- THEME TOGGLE (settings modal) ----------
    const themeToggle = document.getElementById("themeToggle");

    function syncThemeToggle(){
      const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      if(themeToggle) themeToggle.checked = (t === 'dark');
    }
    syncThemeToggle();

    themeToggle.addEventListener("change", (e) => {
      prefs.applyTheme(e.target.checked ? "dark" : "light");
      syncThemeToggle();
    });

    // keep toggle + lang UI in sync across tabs
    window.addEventListener('storage', (e) => {
      if (!e.key) return;
      if (e.key === 'is.pref.theme') syncThemeToggle();
      if (e.key === 'is.pref.lang') applyLangToUI();
    });

    // ---------- CONTACT SUBMIT ----------
    const form = document.getElementById("contactForm");
    const statusEl = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const L = prefs.get('lang', 'is') === 'en' ? 'en' : 'is';
      statusEl.textContent = (L === 'en') ? "Sending..." : "Sendi...";

      const payload = {
        name: form.name.value.trim(),
        email: form.email.value.trim(),
        message: form.message.value.trim()
      };

      try{
        const res = await fetch("/api/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok){
          const txt = await res.text().catch(() => "");
          throw new Error(txt || "Error.");
        }

        statusEl.textContent = (L === 'en') ? "Sent. Thanks!" : "Sent. Takk!";
        form.reset();

        // close overlay (site.js provides helpers)
        setTimeout(() => {
          if (window.site?.closeOverlayById) window.site.closeOverlayById("contactOverlay");
          else document.getElementById("contactOverlay")?.classList.remove("open");
        }, 700);

      }catch(err){
        statusEl.textContent = (L === 'en')
          ? "Failed to send. Try again shortly."
          : "TÃ³kst ekki aÃ° senda. Reyndu aftur eftir smÃ¡.";
      }
    });
  </script>
</body>
</html>